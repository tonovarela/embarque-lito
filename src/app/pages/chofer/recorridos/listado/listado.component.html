<div class="sm:ml-52  py-8 px-2  ">
   <div class="p-1   rounded-lg  h-full  dark:border-gray-700 mt-8 transition-colors duration-30 ">
      <div
         class="flex justify-between items-center w-full p-2 bg-transparent dark:bg-gray-500 rounded-tr-md rounded-tl-md text-gray-600 dark:text-white">
         @if (!isRunning()){
            <div class="flex  justify-between w-full  space-x-2">
               <h1 class="text-2xl ">Recorridos</h1>
            </div>
         
         }
      </div>
      <div class="w-full">
         @if (cargando()) {
         <div>
            <div class="animate-pulse flex space-x-4">
               <div class="flex-1 space-y-4 py-1">
                  <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4"></div>
                  <div class="space-y-2">
                     <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded"></div>
                     <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-5/6"></div>
                  </div>
               </div>
            </div>
         </div>
         }@else{
         @if(!(recorridoActivoInicio || recorridoActivoFin || isRunning() || recorridoPorFirmar() )){
            
         <ejs-grid #grid [dataSource]='Recorridos()' [filterSettings]="filterSettings " (dataBound)='dataBound()'
            [allowExcelExport]='true' AutoFitAll="true" [height]="heightGrid" allowReordering='true'
            [allowFiltering]=true allowPaging="true " allowResizing="true" allowSorting="true"
            [pageSettings]='pageSettings'>
            <e-columns>
               <e-column field='id_recorrido' [allowFiltering]="false" headerText='' width='40'> >
                  <ng-template #template let-data>
                     <div class="grid grid-cols-2  space-x-2  p-1  ">
                        @if(data.porFirmar =='1'){
                        <svg (click)="mostrarPad(data)" class="h-6 w-6 fill-current" version="1.1" id="Capa_1"
                           xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                           viewBox="0 0 478.135 478.135" xml:space="preserve">
                           <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                           <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                           <g id="SVGRepo_iconCarrier">
                              <g>
                                 <path
                                    d="M464.124,88.771c-18.685-18.683-49.082-18.681-67.765,0l-58.636,58.637H15c-8.284,0-15,6.716-15,15v225.968 c0,8.284,6.716,15,15,15h351.427c8.284,0,15-6.716,15-15V239.232l82.697-82.697C482.806,137.851,482.806,107.453,464.124,88.771z M430.241,94.737c7.457,0,14.468,2.903,19.74,8.177c10.389,10.389,10.853,26.993,1.409,37.949l-39.359-39.359 C417.095,97.129,423.483,94.737,430.241,94.737z M338.976,247.416l-33.496-33.496l-2.991-2.991l95.341-95.342l39.479,39.479 l-95.341,95.341L338.976,247.416z M295.95,232.675l5.063,5.063l-18.051,18.051c-3.905,3.905-3.905,10.237,0,14.143 c1.953,1.952,4.512,2.929,7.071,2.929s5.118-0.977,7.071-2.929l18.051-18.051l5.063,5.063l-10.518,27.043l-58.17,17.376 l17.375-58.17L295.95,232.675z M351.427,373.375H30V177.408h277.723l-26.449,26.449c-3.65,3.65-3.886,9.418-0.714,13.345 l-23.459,9.123c-2.876,1.118-5.074,3.502-5.958,6.458l-23.351,78.178l-9.983,9.983l-11.771-11.771 c-3.905-3.904-10.237-3.904-14.142,0c-3.905,3.905-3.905,10.237,0,14.143l11.77,11.77l-11.77,11.77 c-3.905,3.905-3.906,10.237,0,14.143c1.953,1.952,4.512,2.929,7.071,2.929c2.559,0,5.119-0.977,7.071-2.929l11.771-11.771 l11.771,11.771c1.953,1.952,4.512,2.929,7.071,2.929s5.119-0.977,7.071-2.929c3.905-3.905,3.905-10.237,0-14.143l-11.77-11.77 l9.983-9.982l78.178-23.352c2.956-0.884,5.339-3.082,6.458-5.957l9.124-23.459c1.826,1.475,4.049,2.214,6.274,2.214 c2.56,0,5.118-0.977,7.071-2.929l2.389-2.389V373.375z">
                                 </path>
                                 <path
                                    d="M65.925,229.621h156.915c5.523,0,10-4.478,10-10s-4.477-10-10-10H65.925c-5.523,0-10,4.478-10,10 S60.402,229.621,65.925,229.621z">
                                 </path>
                                 <path
                                    d="M212.115,261.07c0-5.522-4.477-10-10-10H65.925c-5.523,0-10,4.478-10,10s4.477,10,10,10h136.19 C207.638,271.07,212.115,266.592,212.115,261.07z">
                                 </path>
                              </g>
                           </g>
                        </svg>
                        }@else {
                        <svg class="h-6 w-6 cursor-pointer fill-current" (click)="startCounter(data)" version="1.1"
                           id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                           viewBox="0 0 60 60" xml:space="preserve">
                           <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                           <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                           <g id="SVGRepo_iconCarrier">
                              <g>
                                 <path
                                    d="M45.563,29.174l-22-15c-0.307-0.208-0.703-0.231-1.031-0.058C22.205,14.289,22,14.629,22,15v30 c0,0.371,0.205,0.711,0.533,0.884C22.679,45.962,22.84,46,23,46c0.197,0,0.394-0.059,0.563-0.174l22-15 C45.836,30.64,46,30.331,46,30S45.836,29.36,45.563,29.174z M24,43.107V16.893L43.225,30L24,43.107z">
                                 </path>
                                 <path
                                    d="M30,0C13.458,0,0,13.458,0,30s13.458,30,30,30s30-13.458,30-30S46.542,0,30,0z M30,58C14.561,58,2,45.439,2,30 S14.561,2,30,2s28,12.561,28,28S45.439,58,30,58z">
                                 </path>
                              </g>
                           </g>
                        </svg>
                        }
                     </div>


                  </ng-template>
               </e-column>
               <e-column field='destino' />
               <e-column field='observaciones' />
               <e-column field='descripcion_tipo_servicio' headerText="Servicio"></e-column>
               <e-column field='nombre_chofer' headerText='chofer' width='150'></e-column>
               <e-column field='descripcion_transporte' headerText='transporte' width='150'></e-column>
               <e-column field='kilometraje_inicial' headerText="Inicial" width='150'>
                  <ng-template #template let-data>
                     @if (data.tipo=='interno' && !data.kilometraje_inicial){
                     <h1 class="border rounded px-1 text-center text-white  bg-amber-500">PENDIENTE</h1>
                     }@else{
                     {{data.kilometraje_inicial ??'N/A'}}
                     }
                  </ng-template>
               </e-column>
               <e-column field='kilometraje_final' headerText="Final" width='150'>
                  <ng-template #template let-data>
                     @if (data.tipo=='interno' && !data.kilometraje_final){
                     <h1 class="border rounded px-1 text-white text-center  bg-amber-500">PENDIENTE</h1>
                     }@else{
                     {{data.kilometraje_final ??'N/A'}}
                     }

                  </ng-template>
               </e-column>
               <e-column field='fecha_salida' headerText="Salida" width='150'>
                  <ng-template #template let-data>
                     @if(data.tipo=='interno'){
                     @if (!data.fecha_salida){
                     <h1 class="border rounded text-center px-1 max-w-20 text-white  bg-amber-500">PENDIENTE</h1>
                     }@else{
                     {{data.fecha_salida ? (data.fecha_salida | date: 'dd-MM-yyyy hh:mm a'):'N/A' }}
                     }
                     }@else{
                     {{data.fecha_salida ? (data.fecha_salida | date: 'dd-MM-yyyy'):'N/A' }}
                     }
                  </ng-template>
               </e-column>
               <e-column field='fecha_regreso' headerText="Llegada" allowEditing="false" width='150'>
                  <ng-template #template let-data>
                     @if(data.tipo=='interno' && !data.fecha_salida){
                     <h1 class="border rounded text-center px-1 max-w-20 text-white bg-amber-500">PENDIENTE</h1>
                     }@else{
                     {{data.fecha_regreso ? (data.fecha_regreso | date: 'dd-MM-yyyy hh:mm a'):'N/A' }}
                     }
                  </ng-template>
               </e-column>
            </e-columns>
         </ejs-grid>
         }
         }
      </div>
   </div>

   @if(recorridoActivoInicio){
   <dialog-captura-kilometraje title="Capture kilometraje inicial" (save)="setRecorrridoInicial($event)"
      [minimoKilometraje]="recorridoActivoInicio.kilometraje_inicial ?? 0" [recorrido]="recorridoActivoInicio" />
   }

   @if (recorridoActivoFin){
   <dialog-captura-kilometraje title="Capture kilometraje final" (save)="setRecorrridoFinal($event)"
      [minimoKilometraje]="recorridoActivoFin.kilometraje_inicial ?? 0" [recorrido]="recorridoActivoFin" />
   }


   @if(isRunning() ){
   <recorrido-actual [recorridoEnCurso]="recorridoEnCurso()!" [visibleStopCounter]="!recorridoActivoFin"
      (onStopCounter)="stopCounter()" />

   }
   @if(recorridoPorFirmar() ){
   
       <!-- Firma Pad -->
  <firma-pad (onGuardarFirma)="guardarFirma($event)" (onCancelar)="cancelarFirma()"></firma-pad>
  <!-- Loader -->
  <div *ngIf="guardandoFirma()" class="absolute inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-10">
    <div class="flex flex-col items-center">
      <svg class="animate-spin h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path>
      </svg>
      <p class="text-white mt-2">Guardando firma...</p>
    </div>
  </div>
   }