<div id="wrapper" class="flex justify-center  ">
    <div
        class="font-roboto w-[32rem] mx-4 mt-2 px-5  py-4  bg-white  space-y-3 border border-gray-400  rounded-md  dark:border-white dark:bg-gray-900/50">
        <div class="grid gap-1 ">
            <app-autocomplete [hasError]="tieneError('ops')" (onSelect)="onSelectOP($event)"></app-autocomplete>
            <div class="flex items-start justify-start flex-wrap gap-2 mt-2 w-full ">
                @for (op of formRegistro.get('ops')!.value;track op){
                <p-chip
                    styleClass="bg-blue-100  text-blue-500 text-xs border px-2 font-roboto border-blue-700 dark:bg-gray-700 dark:text-white"
                    label="{{op}}" (onRemove)="onRemoverOP(op)" [removable]="true"></p-chip>
                }
            </div>
        </div>

        <form class="space-y-3" [formGroup]="formRegistro">
            <div class="w-full">
                <select id="chofer" formControlName="chofer" (change)="actualizarTransporte()"
                    aria-placeholder="Seleccione un chofer"
                    [ngClass]="{'input-invalido': tieneError('chofer'), 'input': !tieneError('chofer') }">
                    <option value='0'>SELECCIONE UN CHOFER</option>s
                    @for (chofer of choferes;track chofer.id){
                    <option value="{{chofer.id}}">{{chofer.nombre}}</option>
                    }
                </select>
            </div>
            <div class="w-full">
                <select id="transporte" formControlName="transporte" (change)="actualizarKilometrajeInicial()"
                    aria-placeholder="Seleccione una unidad de transporte" class="capitalize"
                    [ngClass]="{'input-invalido': tieneError('transporte'), 'input': !tieneError('transporte') }">
                    <option value="0">SELECCIONE UNA UNIDAD DE TRANSPORTE</option>
                    @for (transporte of transportes;track transporte.id_transporte){
                    <option value="{{transporte.id_transporte}}">{{transporte.descripcion}} -
                        {{transporte.placas}}
                    </option>
                    }
                </select>
            </div>
            <div class="w-full">
                <select id="transporte" formControlName="tipo_servicio"
                    aria-placeholder="Seleccione un tipo de servicio" class="uppercase"
                    [ngClass]="{'input-invalido': tieneError('tipo_servicio'), 'input': !tieneError('tipo_servicio') }">
                    <option value="0">SELECCIONE UN TIPO DE SERVICIO</option>
                    @for (tipo of tipoServicios;track tipo.id){
                    <option value="{{tipo.id}}">{{tipo.descripcion}} </option>
                    }
                </select>
            </div>
            <div class="max-w-[32rem]">
                <label for="end-time"
                    class="block  mb-2 text-sm font-medium text-gray-900 dark:text-white">Kilometraje</label>
                <div class="grid sm:grid-cols-2 grid-cols-1 gap-2">
                    <div class="relative flex items-center mb-2">
                        <button type="button" [disabled]="formRegistro.get('kilometraje_inicial')!.disabled"
                            (click)="incrementar(-1,'kilometraje_inicial')" id="decrement-button"
                            class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 hover:bg-gray-200 border border-gray-300 rounded-s-lg p-3 h-10 focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none disabled:cursor-not-allowed">
                            <app-minus />
                        </button>
                        <input type="text" formControlName="kilometraje_inicial"
                            class=" bg-gray-50 border-x-0 border-gray-300 h-10 font-medium text-center text-gray-900 text-sm focus:ring-blue-500 focus:border-blue-500 block w-full pb-6 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 disabled:cursor-not-allowed disabled:bg-gray-200"
                            placeholder="" required />
                        <div
                            class="absolute bottom-1 start-1/2 -translate-x-1/2 rtl:translate-x-1/2 flex items-center text-xs text-gray-400 space-x-1 rtl:space-x-reverse">
                            <app-gauge />
                            <span> Inicial</span>
                        </div>
                        <button type="button" [disabled]="formRegistro.get('kilometraje_inicial')!.disabled"
                            id="increment-button" (click)="incrementar(1,'kilometraje_inicial')"
                            class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 hover:bg-gray-200 border border-gray-300 rounded-e-lg p-3 h-10 focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none disabled:cursor-not-allowed">
                            <app-plus />
                        </button>
                    </div>
                    <div class="relative flex items-center mb-2">
                        <button type="button" [disabled]="formRegistro.get('kilometraje_final')!.disabled"
                            (click)="incrementar(-1,'kilometraje_final')" id="decrement-button"
                            class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 hover:bg-gray-200 border border-gray-300 rounded-s-lg p-3 h-10 focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none disabled:cursor-not-allowed">
                            <app-minus />
                        </button>
                        <input type="text" formControlName="kilometraje_final"
                            class="bg-gray-50 border-x-0 border-gray-300 h-10 font-medium text-center text-gray-900 text-sm focus:ring-blue-500 focus:border-blue-500 block w-full pb-6 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 disabled:cursor-not-allowed disabled:bg-gray-200"
                            placeholder="" required />
                        <div
                            class="absolute bottom-1 start-1/2 -translate-x-1/2 rtl:translate-x-1/2 flex items-center text-xs text-gray-400 space-x-1 rtl:space-x-reverse">
                            <app-gauge />
                            <span> Final</span>
                        </div>
                        <button type="button" [disabled]="formRegistro.get('kilometraje_final')!.disabled"
                            id="increment-button" (click)="incrementar(1,'kilometraje_final')"
                            class="bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:border-gray-600 hover:bg-gray-200 border border-gray-300 rounded-e-lg p-3 h-10 focus:ring-gray-100 dark:focus:ring-gray-700 focus:ring-2 focus:outline-none disabled:cursor-not-allowed">
                            <app-plus />
                        </button>
                    </div>
                </div>
                @if(formRegistro.errors && formRegistro.errors["kilometrajeInvalido"]){
                <div class="text-red-500 dark:bg-white text-xs text-center rounded  p-1.5 w-full">
                    {{formRegistro.errors["mensaje"]}}

                </div>
                }
            </div>

            <div class="space-y-2">
                <label for="start-time" class="block  text-xs font-medium text-gray-900 dark:text-white">Salida</label>
                <div class="w-full grid  sm:grid-cols-2  grid-cols-1 gap-2 ">
                    <div class="relative ">

                        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                            <app-calendar />
                        </div>
                        <input id="fecha_salida" (changeDate)="actualizarFecha($event,'fecha_salida')"
                            name="fecha_salida" datepicker datepicker-autohide datepicker-format="dd-mm-yyyy"
                            (keypress)="OnKeyPress($event)" type="text" tabindex="1"
                            class="bg-gray-50 border w-full border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block  ps-10 p-2  text-center  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                            placeholder="Fecha de salida" />
                    </div>
                    <div class="relative">
                        <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                            <app-time />
                        </div>
                        <input type="time" id="start-time" tabindex="2" formControlName="hora_salida" name="hora_salida"
                            class="bg-gray-50   leading-none border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 text-center dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                            value="00:00" required />
                    </div>
                </div>
                @if (formRegistro.errors && formRegistro.errors["fechaSalidaInvalida"] ){
                <div
                    class="text-red-500 dark:bg-white text-xs flex  sm:flex-row flex-col  justify-between rounded  p-1.5 w-full">
                    <p>Fecha mínima : {{fechaMinimaSalida | date:'dd-MM-yyyy hh:mm a'}} </p>
                    <div class="flex flex-row gap-2 ">
                        <svg fill="current" class="w-5 h-5 fill-blue-500" viewBox="0 0 1000 1000" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" enable-background="new 0 0 1000 1000" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g transform="translate(0.000000,511.000000) scale(0.100000,-0.100000)"> <path d="M5756.7,4574.2L5000,4136.4l4-879.6l5.9-879.6l750.8-433.8c414-239.7,754.7-433.8,760.7-433.8c5.9,0,352.6,198.1,770.6,437.8l758.7,437.8v875.6v873.6L7296,4570.2c-416,239.7-760.7,437.8-768.7,439.8C6521.4,5012,6174.7,4815.8,5756.7,4574.2z M7135.5,4277l578.5-334.8v-679.5v-679.5l-578.5-332.8c-318.9-184.2-590.3-336.8-602.2-340.7c-13.9-4-285.3,144.6-606.2,328.8l-580.4,336.8v687.4v685.4l574.5,334.8c317,184.2,588.4,332.8,604.2,330.8C6543.2,4611.8,6816.6,4459.3,7135.5,4277z"></path> <path d="M6360.9,3991.7c-7.9-5.9-13.9-233.8-13.9-505.2v-491.3h336.8h336.8v168.4v168.4h-168.4h-168.4v336.8v336.8h-154.5C6444.1,4005.6,6366.9,3999.7,6360.9,3991.7z"></path> <path d="M3643,2789.3l-317-186.2l-9.9-1323.3l-9.9-1323.3l-677.5-485.3l-679.5-485.3v-806.3v-806.3l675.5-1081.6L3300.3-4790h198.1c150.6,0,194.1,5.9,182.3,23.8c-7.9,13.9-320.9,517-695.3,1117.3l-679.5,1089.6v693.4v691.4l493.3,352.6c271.4,192.2,497.2,350.6,505.2,350.6c5.9,0,11.9-360.6,11.9-802.3V-2076h168.4h168.4V168.4v2242.5l168.4,95.1l168.4,95.1l162.4-95.1l164.4-97.1l5.9-1400.6l4-1400.6h168.4h168.4v342.7v342.7l168.4,95.1c93.1,51.5,174.3,91.1,184.2,87.1c7.9-2,83.2-45.6,168.4-93.1l152.5-89.2V-49.5v-342.7h166.4h164.4l13.9,105c5.9,55.5,11.9,162.5,11.9,235.8V81.3l134.7,77.2c73.3,43.6,150.6,87.2,172.3,99c33.7,15.9,69.3,4,206-71.3l164.4-93.1l-7.9-241.7l-7.9-243.7h164.4h164.4v166.4v166.4l156.5,91.1c85.2,49.5,164.4,93.1,174.3,95.1c9.9,4,95.1-37.6,190.2-89.2l170.4-95.1v-1014.3v-1014.3l-346.7-923.1l-344.7-925.1v-427.9V-4790h168.4h168.4v396.2v396.2l346.7,925.1l346.7,923.1v1133.1c0,883.5-5.9,1139.1-23.8,1154.9c-13.9,9.9-168.4,103-342.7,202.1l-317,184.2l-99-57.4c-53.5-29.7-130.7-73.3-170.4-95.1l-73.3-39.6l-324.9,166.4L6038,665.7l-164.4-95.1c-194.1-110.9-136.7-124.8-568.5,126.8L5000,873.7l-162.4-97.1l-164.4-95.1l-5.9,956.8l-4,956.8l-328.8,190.2c-180.3,105-338.8,190.2-350.6,190.2C3969.9,2973.5,3817.3,2890.3,3643,2789.3z"></path> </g> </g> </g></svg>
                        <a class="text-blue-500 cursor-pointer">Fijar sálida mínima </a>
                    </div>
                </div>
                }

                <label for="end-time" class="block   text-sm font-medium text-gray-900 dark:text-white">Regreso</label>
                <div class="w-full grid  sm:grid-cols-2  grid-cols-1 gap-2 ">
                    <div>
                        <div class="relative">
                            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                <app-calendar />
                            </div>
                            <input id="fecha_regreso" tabindex="3" datepicker datepicker-autohide
                                datepicker-format="dd-mm-yyyy" type="text" readonly name="fecha_regreso"
                                (keypress)="OnKeyPress($event)" (changeDate)="actualizarFecha($event,'fecha_regreso')"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm text-center rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                placeholder="Fecha regreso">

                        </div>
                    </div>
                    <div class="relative">

                        <div class="absolute inset-y-0 end-0 top-0 flex items-center pe-3.5 pointer-events-none">
                            <app-time />
                        </div>
                        <input type="time" id="start-time" tabindex="2" formControlName="hora_regreso"
                            name="hora_regreso"
                            class="bg-gray-50    leading-none border-gray-300 text-gray-900  text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 w-full text-center p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                            value="00:00" required />

                    </div>
                </div>
            </div>
            <div class="max-w-[24rem] mx-auto flex  items-center justify-around text-2xl text-gray-500 dark:text-white">
                @if(diferenciaTiempo.horas> 0){
                <div>{{diferenciaTiempo.horas}} hora{{diferenciaTiempo.horas>1?'s':''}}</div>
                }
                @if(diferenciaTiempo.minutos > 0){
                <div>{{diferenciaTiempo.minutos}} minuto{{diferenciaTiempo.minutos>1?'s':''}} </div>
                }
            </div>
            @if ( tieneError('hora_regreso') )
            {
            <div class="text-red-500 dark:bg-white text-xs text-center rounded  p-1.5 w-full">
                La diferencia entre la salida y el regreso debe de ser mayor a 1 hora
            </div>
            }
            <div class="w-full">
                <input name="destino" placeholder="Destino" formControlName="destino"
                    [ngClass]="{'input-invalido': tieneError('destino'), 'input': !tieneError('destino') }" />
            </div>

            <div class="w-full">
                <textarea id="observaciones" rows="4" formControlName="observaciones"
                    class="block dark:placeholder:text-white p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                    placeholder="Escribe tus observaciones aqui..."></textarea>

            </div>
        </form>

    </div>
</div>